<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8">
  <title>Dettaglio Match</title>
  <link rel="stylesheet" href="css/style.css">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="manifest" href="/inpsvitale/manifest.json">
<meta name="theme-color" content="#1e90ff">

</head>
<script src="js/pwa.js"></script>

<body>

<nav class="navbar">
  <strong>‚öΩ InpsVitale Stats</strong>
  <div class="nav-links">
    <a href="matches.html">‚Üê Match</a>
    <button id="darkToggle">üåô</button>
  </div>
</nav>

<main class="content">
  <div id="content">‚è≥ Caricamento match‚Ä¶</div>
</main>

<script type="module">
/* =====================
   IMPORT
===================== */
import { initDarkMode } from "./js/darkmode.js";
import { getMatches, getPlayers } from "./js/db.js";
import { computeMatchMVP } from "./js/stats.js";

/* =====================
   INIT
===================== */
initDarkMode();

const out = document.getElementById("content");

/* =====================
   LOAD DATA
===================== */
try {
  const id = new URLSearchParams(location.search).get("id");

  const matches = await getMatches();
  const players = await getPlayers();

  const match = matches.find(m => m.id === id);

  if (!match) {
    out.innerHTML = "<p>‚ùå Match non trovato</p>";
    throw new Error("Match non trovato");
  }

  /* =====================
     HELPERS
  ===================== */
  const nameOf = pid =>
    players.find(p => p.id === pid)?.name || pid;

  const goals = Array.isArray(match.goals) ? match.goals : [];

  /* =====================
     MVP (USO DI match SOLO ORA)
  ===================== */
  const mvpId = computeMatchMVP({ ...match, goals });
  const mvpName = mvpId ? nameOf(mvpId) : "‚Äî";

  /* =====================
     RENDER
  ===================== */
  out.innerHTML = `
    <div class="match-detail">
      <h2>${match.scoreA} - ${match.scoreB}</h2>
      <p><strong>${match.date} ‚Ä¢ ${match.time}</strong></p>
      <p>${match.place || ""}</p>

      <h3>Squadra A</h3>
      <p>${match.teamA.map(nameOf).join(", ")}</p>

      <h3>Squadra B</h3>
      <p>${match.teamB.map(nameOf).join(", ")}</p>

      <h3>‚≠ê MVP del Match</h3>
      <p><strong>${mvpName}</strong></p>

      <h3>‚öΩ Gol</h3>
      <ul>
        ${goals.map(g => `
          <li>
            ${nameOf(g.scorer)}
            ${g.assist ? "(assist " + nameOf(g.assist) + ")" : ""}
          </li>
        `).join("")}
      </ul>
    </div>
  `;
}
catch (err) {
  out.innerHTML = `
    <div class="match-detail">
      <h3>‚ùå Errore</h3>
      <pre>${err.message}</pre>
    </div>
  `;
  console.error(err);
}
</script>

</body>
</html>
